# WePray - Prayer Tutoring App

## Project Overview
WePray is a Christian prayer tutoring app built with SwiftUI for iOS. It provides AI-powered prayer guidance using Claude API for written chat and OpenAI API for voice prayers.

## Implementation Checklist

### Phase 1: Core Setup (COMPLETED)
- [x] Create SharedTypes.swift with core models
- [x] Create WePrayApp.swift main entry point
- [x] Create ContentView.swift with navigation
- [x] Set up AppState for global state management

### Phase 2: Authentication (COMPLETED)
- [x] Create AuthView.swift with login/signup
- [x] Implement language selection on auth screen
- [x] Implement denomination selection on auth screen
- [x] Auto-redirect to chat after successful login

### Phase 3: Language Selection (COMPLETED)
- [x] Default languages: Brazilian Portuguese, Chinese, English, French, Russian, Spanish (alphabetized)
- [x] Language model with code, name, nativeName, flag
- [x] Custom language addition with permanent storage
- [x] Languages sorted alphabetically in all dropdowns

### Phase 4: Christian Denomination (COMPLETED)
- [x] Default denominations: Anglican, Baptist, Catholic, Lutheran, Methodist, Non-denominational, Orthodox, Pentecostal, Presbyterian, Protestant (alphabetized)
- [x] Duplicate prevention (case-insensitive)
- [x] Custom denomination addition with permanent storage
- [x] Denominations sorted alphabetically in all dropdowns

### Phase 5: Prayer Chat (COMPLETED)
- [x] Create PrayerChatView.swift with chat interface
- [x] Create PrayerChatViewModel.swift with Claude API integration
- [x] Language dropdown on chat page
- [x] Denomination dropdown on chat page
- [x] AI responds in user's native language
- [x] AI responds with cheerful and helpful attitude
- [x] Prayers conform to user's selected denomination

### Phase 6: Voice Prayer (COMPLETED)
- [x] Create VoicePrayerView.swift with voice interface
- [x] Create VoicePrayerViewModel.swift with OpenAI API integration
- [x] Language dropdown on voice page
- [x] Denomination dropdown on voice page
- [x] Voice prayers in user's native language
- [x] Text-to-speech for AI prayer responses

### Phase 7: Admin Panel (COMPLETED)
- [x] Create AdminView.swift with admin interface
- [x] AI API selection for written chat prayers
- [x] AI API selection for voice/audio prayers
- [x] AI API selection for prayer tutor responses
- [x] Language management (view all, add custom)
- [x] Denomination management (view all, add custom)

### Phase 8: Settings (COMPLETED)
- [x] Create SettingsView.swift with user settings
- [x] Language selection in settings
- [x] Denomination selection in settings
- [x] Add custom language option
- [x] Add custom denomination option
- [x] Logout functionality

### Phase 9: Responsive Design (COMPLETED)
- [x] GeometryReader for adaptive layouts
- [x] Auto-sizing to fit user's device screen
- [x] Support for iPhone and iPad
- [x] Portrait and landscape orientations

## File Structure (All under 350 lines)

```
wepray/
├── SharedTypes.swift (244 lines) - Core types, colors, models, 10 featured articles
├── WePrayApp.swift (112 lines) - Main app entry, AppState
├── ContentView.swift (79 lines) - Root view, tab navigation
├── AuthView.swift (235 lines) - Login/signup UI
├── LandingPageView.swift (271 lines) - Cinematic landing page
├── BenefitsSection.swift (145 lines) - Cinematic benefits with animations
├── FeaturedPrayersCarousel.swift (252 lines) - Mobile-optimized prayer carousel
├── FeaturedPrayersAdminView.swift (290 lines) - Admin management for prayers
├── FeaturedArticlesCarousel.swift (193 lines) - Mobile-optimized articles carousel
├── FeaturedArticlesAdminView.swift (324 lines) - Admin management for articles
├── PrayerChatView.swift (250 lines) - Chat interface
├── PrayerChatViewModel.swift (225 lines) - Chat logic, API calls
├── VoicePrayerView.swift (266 lines) - Voice prayer interface
├── VoicePrayerViewModel.swift (241 lines) - Voice logic with GPT-4o & TTS
├── OpenAIService.swift (310 lines) - Centralized OpenAI API (GPT-4o, Whisper, TTS)
├── SpeakingPracticeView.swift (280 lines) - Speaking practice UI
├── SpeakingPracticeViewModel.swift (255 lines) - Speaking practice with GPT-4o
├── ListeningPracticeView.swift (285 lines) - Listening practice UI
├── ListeningPracticeViewModel.swift (250 lines) - Listening practice with GPT-4o
├── AdminView.swift (335 lines) - Admin panel with featured articles link
├── SettingsView.swift (210 lines) - User settings
├── FeedView.swift (204 lines) - Prayer sharing feed with profile nav
├── GroupsView.swift (309 lines) - Community groups with detail view
├── SubscriptionView.swift (240 lines) - Subscription management
├── UserProfileView.swift (224 lines) - User profile & follow system
├── Info.plist - App configuration
└── project-tasks.mdc - This file
```

## Features

### Language Selection
- 6 default languages (alphabetized): Brazilian Portuguese, Chinese, English, French, Russian, Spanish
- Custom languages stored permanently via UserDefaults
- All dropdowns show languages in alphabetical order

### Christian Denomination Selection
- 10 default denominations (alphabetized)
- No duplicates allowed (case-insensitive check)
- Custom denominations stored permanently
- All dropdowns show denominations in alphabetical order

### AI Integration
- Claude API for written chat prayer tutoring (cheerful, helpful attitude)
- OpenAI GPT-4o for voice prayer tutoring (denomination-conforming prayers)
- OpenAI Whisper for speech-to-text transcription
- OpenAI TTS (tts-1-hd) for high-quality voice responses
- 6 voice options: alloy, echo, fable, onyx, nova, shimmer
- Admin can change AI API for each feature:
  - Written chat prayers
  - Voice/audio prayers
  - Prayer tutor responses

### Advanced Voice Mode (GPT-4o)
- **Speaking Practice**: Practice pronouncing prayers with real-time GPT-4o feedback
  - Difficulty levels: Beginner, Intermediate, Advanced
  - Pronunciation scoring (0-100%)
  - Prayer phrases generated by denomination
  - Progress tracking and history
- **Listening Practice**: Comprehension exercises with OpenAI TTS
  - Multiple choice questions
  - Variable playback speeds (0.5x - 1.5x)
  - Accuracy tracking
  - High-quality voice synthesis

### Responsive Design
- Uses GeometryReader for adaptive layouts
- Auto-sizes to fit any device screen
- Supports iPhone and iPad
- Works in portrait and landscape

### Login Flow
- Login/signup with email and password
- Language and denomination selection during auth
- Automatic redirect to chat screen after successful login
- Admin users detected by email pattern

## API Configuration

Set environment variables:
- `OPENAI_API_KEY` - OpenAI API key for voice prayers
- `CLAUDE_API_KEY` - Claude/Anthropic API key for chat
- `DEEPSEEK_API_KEY` - DeepSeek API key (optional)
- `SUPABASE_URL` - Supabase project URL (optional)
- `SUPABASE_ANON_KEY` - Supabase anon key (optional)

## Previous Solutions Applied

From LangTutor project-tasks.mdc:
- Modular component approach (under 350 lines)
- Duplicate prevention patterns (Steps 75-81)
- Type-safe API integration (Steps 72-77)
- Responsive SwiftUI layouts (Steps 78-79)
- UserDefaults for permanent storage

---

## Phase 10: Advanced Voice Mode with GPT-4o (COMPLETED)

### OpenAI Service Integration
- [x] Create OpenAIService.swift - Centralized API module
- [x] Implement Whisper API transcription (speech-to-text)
- [x] Implement OpenAI TTS API (text-to-speech with high-quality voices)
- [x] Implement GPT-4o chat completions for voice responses
- [x] Add audio file caching and management

### Speaking Practice Feature
- [x] Create SpeakingPracticeView.swift - UI for prayer speaking practice
- [x] Create SpeakingPracticeViewModel.swift - Logic with GPT-4o
- [x] Implement real-time pronunciation feedback
- [x] Add prayer phrase suggestions by denomination
- [x] Score and track speaking progress
- [x] Support all 6 languages for speaking practice

### Listening Practice Feature
- [x] Create ListeningPracticeView.swift - UI for listening practice
- [x] Create ListeningPracticeViewModel.swift - Logic with GPT-4o
- [x] Generate prayer audio clips using OpenAI TTS
- [x] Implement comprehension questions
- [x] Track listening progress and scores
- [x] Variable playback speeds

### Voice Prayer Enhancements
- [x] Upgrade VoicePrayerViewModel to use GPT-4o model
- [x] Replace AVSpeechSynthesizer with OpenAI TTS
- [x] Implement real Whisper transcription
- [x] Add voice selection (alloy, echo, fable, onyx, nova, shimmer)
- [ ] Add real-time audio streaming support (future enhancement)

### Navigation Updates
- [x] Update ContentView with Speaking Practice tab
- [x] Update ContentView with Listening Practice tab
- [ ] Add Advanced Voice Mode section in Admin Panel (future enhancement)
- [ ] Add voice settings in Settings view (future enhancement)

---

## Phase 11: Cinematic Landing Page with Featured Prayers Carousel (COMPLETED)

### Landing Page Implementation
- [x] Create LandingPageView.swift with cinematic design (adapted from LangTutor)
- [x] Implement CinematicPrayerBackground with animated orbs
- [x] Add floating religious symbols background
- [x] Create logo and title section with gradient styling
- [x] Add Sign In / Sign Up button
- [x] Add Continue as Guest option

### Featured Prayers Carousel
- [x] Create FeaturedPrayersCarousel.swift component
- [x] Implement PrayerCard with gradient backgrounds
- [x] Add swipe gesture navigation
- [x] Auto-scroll timer (5 seconds)
- [x] Carousel indicators
- [x] 5 default featured prayers for different denominations

### Admin Panel - Featured Prayers Management
- [x] Create FeaturedPrayersAdminView.swift
- [x] Add/Edit/Delete featured prayers
- [x] Toggle prayer visibility (active/inactive)
- [x] Drag to reorder prayers
- [x] Color picker for gradient customization
- [x] Icon selection for prayer cards

### Data Models
- [x] Add FeaturedPrayer model to SharedTypes.swift
- [x] Include default prayers (Lord's Prayer, Jesus Prayer, Hail Mary, etc.)
- [x] Store featured prayers in AdminSettings

### Navigation Flow
- [x] Update ContentView to show LandingPageView first
- [x] AuthView accessible via Sign In button
- [x] Guest mode bypasses authentication

---

## Phase 13: Cinematic Home Screen Enhancement (COMPLETED)

### Cinematic BenefitsSection
- [x] Enhanced with staggered card entrance animations
- [x] Added gradient title with shadow effects
- [x] Horizontal scrolling cards for mobile optimization
- [x] Scale animations on tap with haptic feedback
- [x] Glow shadow effects on benefit cards

### Featured Articles Carousel
- [x] Expanded from 5 to 10 default articles
- [x] Added haptic feedback on swipe and navigation
- [x] Improved swipe sensitivity with predictedEndTranslation
- [x] Tappable indicators with haptic response
- [x] Navigation arrows optimized for mobile

### Featured Prayers Carousel
- [x] Added navigation arrows for mobile
- [x] Haptic feedback on swipe gestures
- [x] Tappable indicators for direct navigation
- [x] Improved swipe gesture sensitivity
- [x] Timer management with proper cleanup

### Admin Panel Enhancement
- [x] Featured Articles tab in admin panel
- [x] Add/Edit/Delete featured articles
- [x] Toggle article visibility (active/inactive)
- [x] Drag to reorder articles
- [x] Color picker and icon selection

### Bug Fixes
- [x] Removed duplicate `toHex()` function from `FeaturedPrayersAdminView.swift` (defined in `SharedTypes.swift`)
- [x] Merged Swift files into WePray/WePray Xcode project folder
- [x] Lowered iOS deployment target from 18.4 to 17.0
- [x] Fixed nil dictionary value error in `SpeakingPracticeViewModel.swift` (changed to `[String: String?]`)
- [x] Condensed `OpenAIService.swift` from 361 to 349 lines
- [x] Renamed `StatItem` to `ProfileStatItem` in UserProfileView.swift (conflict with SpeakingPracticeView.StatItem)
- [x] Fixed ternary type mismatch (Color vs LinearGradient) in UserProfileView.swift using Group/if-else
- [x] Updated `onChange(of:perform:)` to iOS 17+ syntax in PrayerChatView.swift and VoicePrayerView.swift
- [x] Fixed unused variable warning in ListeningPracticeView.swift (changed `if let prayer` to boolean test)

### Prayer Carousel Content
- [x] Added 5 established prayers: Prayer of St. Francis, Gloria Patri, Apostles' Creed, Act of Contrition, Magnificat
- [x] Total prayers in carousel: 10 (5 original + 5 new)

### Cinematic Navy Blue Theme
- [x] Updated AppColors to cinematic navy blue palette (dark background #0F172A)
- [x] Updated all 10 prayer card gradients to navy/blue variations
- [x] Updated all 10 article card gradients to navy/blue variations
- [x] Updated 4 benefit card gradients to navy/blue variations
- [x] Light text colors for dark background contrast

---

## Phase 12: Social Features from Prayer Repository (MOSTLY COMPLETE)

### User Feed
- [x] Create FeedView.swift for prayer sharing (195 lines)
- [x] Implement post creation and display
- [x] Add like functionality with heart icon
- [x] Implement follow/unfollow system

### User Profile
- [x] Create UserProfileView.swift (224 lines)
- [x] UserProfileData model with stats
- [x] Profile header with avatar, name, bio
- [x] Stats row (Prayers, Followers, Following)
- [x] Follow/Unfollow button with toggle
- [x] User's prayer posts section
- [x] Navigation from Feed to User Profiles (tap author name)

### Prayer Groups
- [x] Create GroupsView.swift for community groups (309 lines)
- [x] Implement group creation sheet
- [x] Add join/leave group functionality
- [x] My Groups horizontal scroll section
- [x] Group-specific prayer posts with GroupDetailView
- [x] Navigate to group detail on tap
- [x] Post prayers within groups

### Subscription System
- [ ] Integrate Stripe for payments (future enhancement)
- [x] Create SubscriptionView.swift (240 lines)
- [x] Implement tier-based features (Free/Standard/Premium)
- [x] Add subscription card UI with features list
- [x] Current plan indicator

### Tab Navigation Update
- [x] Updated ContentView tabs: Pray, Feed, Groups, Voice, Settings
- [x] Integrated FeedView and GroupsView into main navigation

### Social Features Summary
- User Feed: Post creation, likes, profile navigation
- User Profiles: Follow/unfollow, stats, user prayers
- Prayer Groups: Create, join/leave, group-specific posts
- Subscriptions: 3-tier system UI (Stripe integration pending)

---

## Build Instructions

1. Open wepray folder in Xcode
2. Create new iOS App project named "WePray"
3. Replace generated files with these Swift files
4. Set deployment target to iOS 17+
5. Add microphone and speech recognition permissions
6. Set API keys in environment variables or update AppConfig
7. Build and run
